{"ast":null,"code":"var _jsxFileName = \"/Users/Lingo/Rong/JavaScript/26_portfolio/gaze_project/gaze/src/components/singlePage/SinglePage.js\";\n\n/* jsx-a11y/no-static-element-interactions */\nimport React, { Component, Fragment } from 'react';\nimport './SinglePage.css';\nimport { withRouter } from 'react-router-dom';\nimport Loading from '../loading/Loading';\nimport Masonry from 'react-masonry-css';\nimport Fade from 'react-reveal/Fade';\nimport Selector from '../../containers/SelectorContainer';\n\nclass SinglePage extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handlePageScroll = () => {\n      // 下拉加載\n      const scrollTop = document.documentElement.scrollTop;\n      const clientHeight = document.documentElement.clientHeight;\n      const scrollHeight = document.documentElement.scrollHeight;\n\n      if (scrollHeight - clientHeight === scrollTop) {\n        const page = this.state.page;\n        const _this$props = this.props,\n              getImgsList = _this$props.getImgsList,\n              singleImg = _this$props.singleImg,\n              isLoadingGetImgs = _this$props.isLoadingGetImgs;\n\n        if (!isLoadingGetImgs && singleImg.tags) {\n          getImgsList(page + 1, singleImg.tags[1].title);\n          this.setState(prevState => ({\n            page: prevState.page + 1\n          }));\n        }\n      }\n    };\n\n    this.handleHoverOut = () => {\n      this.setState({\n        hoveredImg: ''\n      });\n    };\n\n    this.handleClose = () => {\n      this.setState({\n        showSelector: false\n      });\n      document.body.style.overflow = \"visible\";\n    };\n\n    this.state = {\n      page: 1,\n      hoveredImg: '',\n      previewId: '',\n      currentImgId: this.props.match.params.imgId\n    };\n    const initImgs = this.props.initImgs;\n    initImgs([]);\n  }\n\n  componentDidMount() {\n    const _this$state = this.state,\n          initImgs = _this$state.initImgs,\n          currentImgId = _this$state.currentImgId;\n    const getSingleImg = this.props.getSingleImg;\n    initImgs([]);\n    getSingleImg(currentImgId);\n    window.addEventListener('scroll', this.handlePageScroll);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.handlePageScroll);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const currentImgId = this.state.currentImgId;\n    const _this$props2 = this.props,\n          isLoadingSingleImg = _this$props2.isLoadingSingleImg,\n          getImgsList = _this$props2.getImgsList,\n          singleImg = _this$props2.singleImg,\n          getSingleImg = _this$props2.getSingleImg,\n          isLoadingSaveImg = _this$props2.isLoadingSaveImg,\n          initImgs = _this$props2.initImgs;\n\n    if (prevProps.isLoadingSingleImg === true && isLoadingSingleImg === false) {\n      window.scrollTo(0, 0);\n      getImgsList(1, singleImg.tags[1].title);\n      console.log(singleImg.tags[1].title);\n    }\n\n    if (prevState.currentImgId !== currentImgId) {\n      window.location.reload();\n    }\n\n    if (prevProps.isLoadingSaveImg === true && isLoadingSaveImg === false) {\n      this.setState({\n        showSelector: false\n      });\n      document.body.style.overflow = \"visible\";\n    }\n  }\n\n  handleHoverOver(id) {\n    this.setState({\n      hoveredImg: id\n    });\n  }\n\n  handleSumbit(id) {\n    const history = this.props.history;\n    this.setState({\n      currentImgId: id\n    });\n    history.push(\"/images/\".concat(id));\n  }\n\n  handleSelector(id) {\n    this.setState({\n      previewId: id,\n      showSelector: true\n    });\n    document.body.style.overflow = \"hidden\";\n  }\n\n  render() {\n    const _this$state2 = this.state,\n          page = _this$state2.page,\n          hasMore = _this$state2.hasMore,\n          previewId = _this$state2.previewId,\n          showSelector = _this$state2.showSelector,\n          hoveredImg = _this$state2.hoveredImg,\n          createName = _this$state2.createName,\n          editMode = _this$state2.editMode;\n    const _this$props3 = this.props,\n          singleImg = _this$props3.singleImg,\n          isLoadingSingleImg = _this$props3.isLoadingSingleImg,\n          history = _this$props3.history,\n          imgs = _this$props3.imgs,\n          isLoadingGetImgs = _this$props3.isLoadingGetImgs,\n          isAuthenticated = _this$props3.isAuthenticated,\n          totalPage = _this$props3.totalPage;\n    const breakpointColumnsObj = {\n      default: 4,\n      1100: 2,\n      700: 1\n    };\n    const singlePhoto = React.createElement(Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, !isLoadingSingleImg && singleImg.urls ? React.createElement(\"div\", {\n      className: \"single_container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      className: \"single_img\",\n      src: singleImg.urls.regular,\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"single_info\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      className: \"save_button_dark\",\n      onClick: isAuthenticated ? () => this.handleSelector(singleImg.id) : () => history.push('/login'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      class: \"fas fa-plus\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      class: \"tag_group\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      className: \"subtitle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    }, \"Uploaded by\"), React.createElement(\"div\", {\n      className: \"creater\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      className: \"create_profile\",\n      src: singleImg.user.profile_image.medium,\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      className: \"creater_name\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130\n      },\n      __self: this\n    }, singleImg.user.name)), React.createElement(\"p\", {\n      className: \"subtitle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, \"Related tags\"), React.createElement(\"ul\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, singleImg.tags.map((item, index) => {\n      if (index > 0 && index < 7 && singleImg.tags[index]) {\n        return React.createElement(\"li\", {\n          className: \"single_tag\",\n          style: {\n            backgroundColor: [singleImg.color]\n          },\n          onClick: () => history.push(\"/search/\".concat(singleImg.tags[index].title)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 137\n          },\n          __self: this\n        }, singleImg.tags[index].title);\n      }\n    }))))) : React.createElement(Loading, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }));\n    const relatedImg = React.createElement(\"ul\", {\n      className: \"related_images\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152\n      },\n      __self: this\n    }, React.createElement(Masonry, {\n      breakpointCols: breakpointColumnsObj,\n      className: \"my-masonry-grid\",\n      columnClassName: \"my-masonry-grid_column\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153\n      },\n      __self: this\n    }, imgs ? imgs.map((item, index) => {\n      if (imgs[index]) {\n        return React.createElement(\"div\", {\n          className: \"outter\",\n          onMouseOver: () => this.handleHoverOver(imgs[index].id),\n          onMouseOut: this.handleHoverOut,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          className: hoveredImg === imgs[index].id ? 'save_button' : 'hide_style',\n          onClick: isAuthenticated ? () => this.handleSelector(imgs[index].id) : () => history.push('/login'),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165\n          },\n          __self: this\n        }, React.createElement(\"i\", {\n          class: \"fas fa-plus\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166\n          },\n          __self: this\n        })), React.createElement(Fade, {\n          bottom: true,\n          duration: 600,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 168\n          },\n          __self: this\n        }, React.createElement(\"li\", {\n          key: imgs[index].id,\n          role: \"presentation\",\n          onClick: () => this.handleSumbit(imgs[index].id),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: hoveredImg === imgs[index].id ? 'hover_layer' : 'hide_style',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 171\n          },\n          __self: this\n        }), React.createElement(\"img\", {\n          src: imgs[index].urls.regular,\n          alt: \"\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }))));\n      }\n    }) : React.createElement(Loading, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    })));\n    return React.createElement(Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }, showSelector && React.createElement(Selector, {\n      showSelector: true,\n      previewId: previewId,\n      handleClose: this.handleClose,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }, singlePhoto, relatedImg));\n  }\n\n}\n\nexport default withRouter(SinglePage);","map":{"version":3,"sources":["/Users/Lingo/Rong/JavaScript/26_portfolio/gaze_project/gaze/src/components/singlePage/SinglePage.js"],"names":["React","Component","Fragment","withRouter","Loading","Masonry","Fade","Selector","SinglePage","constructor","props","handlePageScroll","scrollTop","document","documentElement","clientHeight","scrollHeight","page","state","getImgsList","singleImg","isLoadingGetImgs","tags","title","setState","prevState","handleHoverOut","hoveredImg","handleClose","showSelector","body","style","overflow","previewId","currentImgId","match","params","imgId","initImgs","componentDidMount","getSingleImg","window","addEventListener","componentWillUnmount","removeEventListener","componentDidUpdate","prevProps","isLoadingSingleImg","isLoadingSaveImg","scrollTo","console","log","location","reload","handleHoverOver","id","handleSumbit","history","push","handleSelector","render","hasMore","createName","editMode","imgs","isAuthenticated","totalPage","breakpointColumnsObj","default","singlePhoto","urls","regular","user","profile_image","medium","name","map","item","index","backgroundColor","color","relatedImg"],"mappings":"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","sourcesContent":["/* jsx-a11y/no-static-element-interactions */\n\nimport React, { Component, Fragment } from 'react';\nimport './SinglePage.css';\nimport { withRouter } from 'react-router-dom';\nimport Loading from '../loading/Loading';\nimport Masonry from 'react-masonry-css';\nimport Fade from 'react-reveal/Fade';\nimport Selector from '../../containers/SelectorContainer'\n\nclass SinglePage extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      page: 1,\n      hoveredImg: '',\n      previewId:'',\n      currentImgId: this.props.match.params.imgId,\n    };\n    const {initImgs } = this.props;\n    initImgs([]);\n  }\n\n  componentDidMount() {\n    const { initImgs,currentImgId } = this.state;\n    const { getSingleImg, } = this.props;\n    initImgs([]);\n    getSingleImg(currentImgId );\n    window.addEventListener('scroll', this.handlePageScroll);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.handlePageScroll);\n  }\n\n  componentDidUpdate(prevProps,prevState) {\n    const { currentImgId } = this.state;\n    const { isLoadingSingleImg,getImgsList,singleImg,getSingleImg,isLoadingSaveImg,initImgs } = this.props;\n    if (prevProps.isLoadingSingleImg === true && isLoadingSingleImg === false) {\n      window.scrollTo(0,0);\n      getImgsList(1,singleImg.tags[1].title)\n      console.log(singleImg.tags[1].title);\n    }\n    if (prevState.currentImgId !== currentImgId) {\n      window.location.reload()\n    }\n    if (prevProps.isLoadingSaveImg === true && isLoadingSaveImg === false) {\n      this.setState({\n        showSelector:false,\n      })\n      document.body.style.overflow = \"visible\"\n    }\n  }\n\n  handlePageScroll = () => {\n    // 下拉加載\n    const scrollTop = document.documentElement.scrollTop;\n    const clientHeight = document.documentElement.clientHeight;\n    const scrollHeight = document.documentElement.scrollHeight;\n    if (scrollHeight-clientHeight === scrollTop) {\n      const { page } = this.state;\n      const { getImgsList,singleImg,isLoadingGetImgs} = this.props;\n      if(!isLoadingGetImgs && singleImg.tags){\n        getImgsList(page + 1,singleImg.tags[1].title)\n        this.setState((prevState) => ({\n          page: prevState.page + 1,\n        }))\n      }\n    }\n  }\n\n  handleHoverOver(id){\n    this.setState({\n      hoveredImg: id,\n    })\n  }\n\n  handleHoverOut = () => {\n    this.setState({\n      hoveredImg: ''\n    })\n  }\n\n  handleSumbit(id) {\n    const {history} =  this.props\n    this.setState({\n      currentImgId: id,\n    })\n    history.push(`/images/${id}`)\n  }\n\n  handleSelector(id){\n    this.setState({\n      previewId: id,\n      showSelector: true,\n    })\n    document.body.style.overflow = \"hidden\"\n  }\n\n  handleClose = () => {\n    this.setState({\n      showSelector:false,\n    })\n    document.body.style.overflow = \"visible\"\n  }\n\n\n\n  render() {\n    const { page,hasMore,previewId,showSelector,hoveredImg,createName,editMode} = this.state;\n\n    const { singleImg, isLoadingSingleImg,history,imgs,isLoadingGetImgs,isAuthenticated,totalPage }= this.props;\n    const breakpointColumnsObj = {\n      default: 4,\n      1100: 2,\n      700: 1\n    };\n    \n    const singlePhoto = (\n      <Fragment>\n        {!isLoadingSingleImg && singleImg.urls ?\n          <div className=\"single_container\">\n            <img className=\"single_img\" src={singleImg.urls.regular} alt=\"\"/>\n            <div className=\"single_info\">\n              <button className='save_button_dark' onClick={isAuthenticated ? () => this.handleSelector(singleImg.id) : ()=> history.push('/login')}><i class=\"fas fa-plus\"></i></button>\n              <div class=\"tag_group\">\n                <p className=\"subtitle\">Uploaded by</p>\n                <div className=\"creater\">\n                  <img className=\"create_profile\" src={singleImg.user.profile_image.medium} alt=\"\" />\n                  <p className=\"creater_name\">{singleImg.user.name}</p>\n                </div>\n                <p className=\"subtitle\">Related tags</p>\n                <ul>\n                  {singleImg.tags.map((item, index) => {\n                      if ( index > 0 && index < 7  && singleImg.tags[index]) {\n                        return (\n                          <li className=\"single_tag\" style={{ backgroundColor: [singleImg.color]}}\n                          onClick={() => history.push(`/search/${singleImg.tags[index].title}`)}>{singleImg.tags[index].title}</li>\n                        )\n                      }\n                    })\n                  }\n                </ul>\n              </div>\n            </div>\n          </div>\n        : <Loading />}\n      </Fragment>\n    );\n\n    const relatedImg = (\n      <ul className=\"related_images\">\n        <Masonry\n          breakpointCols={breakpointColumnsObj}\n          className=\"my-masonry-grid\"\n          columnClassName=\"my-masonry-grid_column\"\n        >\n          {imgs ? imgs.map((item, index) => {\n            if (imgs[index]) {\n              return (\n                <div className=\"outter\"                           \n                  onMouseOver={() => this.handleHoverOver(imgs[index].id)}\n                  onMouseOut={this.handleHoverOut}\n                >\n                  <button className={hoveredImg === imgs[index].id? 'save_button':'hide_style'} \n                  onClick={isAuthenticated ? () => this.handleSelector(imgs[index].id) : ()=> history.push('/login')}><i class=\"fas fa-plus\"></i></button>\n\n                  <Fade bottom duration={600} >\n                    <li key={imgs[index].id} role=\"presentation\" \n                    onClick={() => this.handleSumbit(imgs[index].id)}>\n                      <div className={hoveredImg === imgs[index].id? 'hover_layer':'hide_style'}></div>\n                      <img src={imgs[index].urls.regular} alt=\"\" />\n                    </li>\n                  </Fade>\n                </div>\n              );\n            }\n          }): <Loading />}\n        </Masonry>\n      </ul>\n    )\n    \n    return (\n      <Fragment>\n        {showSelector && <Selector showSelector = {true}  previewId={previewId} \n        handleClose={this.handleClose}/>}\n        <div className=\"container\">\n          {singlePhoto}\n          {relatedImg}\n        </div>\n      </Fragment>\n    );\n  }\n}\nexport default withRouter(SinglePage);\n"]},"metadata":{},"sourceType":"module"}