{"ast":null,"code":"var _jsxFileName = \"/Users/Lingo/Rong/JavaScript/26_portfolio/gaze_project/gaze/src/components/home/Home.js\";\nimport React, { Component, Fragment } from 'react';\nimport './Home.css';\nimport Search from '../search/Search';\nimport Loading from '../loading/Loading';\nimport Masonry from 'react-masonry-css';\nimport Fade from 'react-reveal/Fade';\nimport Selector from '../../containers/SelectorContainer';\n\nclass Home extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleSearchTxt = item => {\n      this.setState({\n        searchTxt: item\n      });\n    };\n\n    this.handleScroll = () => {\n      // topSearchBar\n      const showTopSearch = this.props.showTopSearch;\n\n      if (document.documentElement.scrollTop > 250) {\n        showTopSearch(true);\n      } else {\n        showTopSearch(false);\n      } // 下拉加載\n\n\n      const scrollTop = document.documentElement.scrollTop;\n      const clientHeight = document.documentElement.clientHeight;\n      const scrollHeight = document.documentElement.scrollHeight;\n\n      if (scrollHeight - clientHeight === scrollTop) {\n        const page = this.state.page;\n        const _this$props = this.props,\n              getImgsList = _this$props.getImgsList,\n              queryTxt = _this$props.queryTxt,\n              getRandomImgs = _this$props.getRandomImgs,\n              totalPage = _this$props.totalPage,\n              isLoadingRandomImgs = _this$props.isLoadingRandomImgs,\n              isLoadingGetImgs = _this$props.isLoadingGetImgs;\n\n        if (totalPage !== 0 && page !== totalPage) {\n          if (queryTxt === '') {\n            if (!isLoadingRandomImgs) {\n              getRandomImgs(page + 1);\n              this.setState(prevState => ({\n                page: prevState.page + 1\n              }));\n            }\n          } else {\n            if (!isLoadingGetImgs) {\n              getImgsList(page + 1, queryTxt);\n              this.setState(prevState => ({\n                page: prevState.page + 1\n              }));\n            }\n          }\n        }\n      }\n    };\n\n    this.handleHoverOut = () => {\n      this.setState({\n        hoveredImg: ''\n      });\n    };\n\n    this.handleClose = () => {\n      this.setState({\n        showSelector: false\n      });\n      document.body.style.overflow = \"visible\";\n    };\n\n    this.state = {\n      page: 1,\n      hoveredImg: '',\n      previewId: '',\n      searchTxt: this.props.match.params.query === undefined ? '' : this.props.match.params.query\n    };\n  }\n\n  componentDidMount() {\n    const _this$props2 = this.props,\n          getImgsList = _this$props2.getImgsList,\n          query = _this$props2.query,\n          getRandomImgs = _this$props2.getRandomImgs,\n          getSynonymList = _this$props2.getSynonymList,\n          initImgs = _this$props2.initImgs,\n          showTopSearch = _this$props2.showTopSearch;\n    const page = this.state.page;\n    window.addEventListener('scroll', this.handleScroll);\n    showTopSearch(false);\n\n    if (this.props.match.params.query !== undefined) {\n      //依照關鍵字搜尋\n      initImgs([]);\n      query(this.props.match.params.query);\n      getSynonymList(this.props.match.params.query);\n      getImgsList(page, this.props.match.params.query);\n    } else {\n      //隨機搜尋\n      query('');\n      initImgs([]);\n      getRandomImgs(page);\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.handleScroll);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const _this$props3 = this.props,\n          isLoadingSaveImg = _this$props3.isLoadingSaveImg,\n          getImgsList = _this$props3.getImgsList,\n          query = _this$props3.query,\n          getSynonymList = _this$props3.getSynonymList,\n          initImgs = _this$props3.initImgs;\n    const _this$state = this.state,\n          page = _this$state.page,\n          searchTxt = _this$state.searchTxt;\n\n    if (prevProps.isLoadingSaveImg === true && isLoadingSaveImg === false) {\n      this.setState({\n        showSelector: false\n      });\n      document.body.style.overflow = \"visible\";\n    }\n\n    if (prevState.searchTxt !== searchTxt) {\n      initImgs([]);\n      query(searchTxt);\n      getSynonymList(searchTxt); //找同義詞\n\n      getImgsList(page, searchTxt);\n    }\n  }\n\n  handleHoverOver(id) {\n    this.setState({\n      hoveredImg: id\n    });\n  }\n\n  handleSelector(id) {\n    this.setState({\n      previewId: id,\n      showSelector: true\n    });\n    document.body.style.overflow = \"hidden\"; // alert('ok')\n  }\n\n  render() {\n    const _this$state2 = this.state,\n          page = _this$state2.page,\n          previewId = _this$state2.previewId,\n          showSelector = _this$state2.showSelector,\n          hoveredImg = _this$state2.hoveredImg;\n    const _this$props4 = this.props,\n          history = _this$props4.history,\n          imgs = _this$props4.imgs,\n          isLoadingGetImgs = _this$props4.isLoadingGetImgs,\n          query = _this$props4.query,\n          queryTxt = _this$props4.queryTxt,\n          getImgsList = _this$props4.getImgsList,\n          initImgs = _this$props4.initImgs,\n          isLoadingRandomImgs = _this$props4.isLoadingRandomImgs,\n          syn = _this$props4.syn,\n          isLoadingSynonym = _this$props4.isLoadingSynonym,\n          getSynonymList = _this$props4.getSynonymList,\n          isAuthenticated = _this$props4.isAuthenticated,\n          totalPage = _this$props4.totalPage;\n    const breakpointColumnsObj = {\n      default: 3,\n      1100: 2,\n      700: 1\n    };\n    return React.createElement(Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, showSelector && React.createElement(Selector, {\n      showSelector: true,\n      previewId: previewId,\n      handleClose: this.handleClose,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141\n      },\n      __self: this\n    }), React.createElement(Search, {\n      query: query,\n      queryTxt: queryTxt,\n      getImgsList: getImgsList,\n      page: page,\n      initImgs: initImgs,\n      history: history,\n      syn: syn,\n      isLoadingSynonym: isLoadingSynonym,\n      getSynonymList: getSynonymList,\n      handleSearchTxt: this.handleSearchTxt,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }), imgs ? React.createElement(\"ul\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    }, React.createElement(Masonry, {\n      breakpointCols: breakpointColumnsObj,\n      className: \"my-masonry-grid\",\n      columnClassName: \"my-masonry-grid_column\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }, imgs.map((item, index) => {\n      if (index > 0 && imgs[index]) {\n        return React.createElement(\"div\", {\n          className: \"outter\",\n          onMouseOver: () => this.handleHoverOver(imgs[index].id),\n          onMouseOut: this.handleHoverOut,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157\n          },\n          __self: this\n        }, React.createElement(\"button\", {\n          className: hoveredImg === imgs[index].id ? 'save_button' : 'hide_style',\n          onClick: isAuthenticated ? () => this.handleSelector(imgs[index].id) : () => history.push('/login'),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 160\n          },\n          __self: this\n        }, React.createElement(\"i\", {\n          class: \"fas fa-plus\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161\n          },\n          __self: this\n        })), React.createElement(Fade, {\n          bottom: true,\n          duration: 600,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162\n          },\n          __self: this\n        }, React.createElement(\"li\", {\n          key: imgs[index].id,\n          role: \"presentation\",\n          onClick: () => history.push(\"/images/\".concat(imgs[index].id)),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 163\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: hoveredImg === imgs[index].id ? 'hover_layer' : 'hide_style',\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 165\n          },\n          __self: this\n        }), React.createElement(\"img\", {\n          src: imgs[index].urls.regular,\n          alt: \"\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166\n          },\n          __self: this\n        }))));\n      }\n    })), totalPage === 0 && React.createElement(\"div\", {\n      className: \"empt_notice\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, \"No results found, please try different keyword.\"), page === totalPage && React.createElement(\"div\", {\n      className: \"empt_notice\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }, \"\".concat(page, \" / \").concat(totalPage))) : React.createElement(Loading, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default Home;","map":{"version":3,"sources":["/Users/Lingo/Rong/JavaScript/26_portfolio/gaze_project/gaze/src/components/home/Home.js"],"names":["React","Component","Fragment","Search","Loading","Masonry","Fade","Selector","Home","constructor","props","handleSearchTxt","item","setState","searchTxt","handleScroll","showTopSearch","document","documentElement","scrollTop","clientHeight","scrollHeight","page","state","getImgsList","queryTxt","getRandomImgs","totalPage","isLoadingRandomImgs","isLoadingGetImgs","prevState","handleHoverOut","hoveredImg","handleClose","showSelector","body","style","overflow","previewId","match","params","query","undefined","componentDidMount","getSynonymList","initImgs","window","addEventListener","componentWillUnmount","removeEventListener","componentDidUpdate","prevProps","isLoadingSaveImg","handleHoverOver","id","handleSelector","render","history","imgs","syn","isLoadingSynonym","isAuthenticated","breakpointColumnsObj","default","map","index","push","urls","regular"],"mappings":"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","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport './Home.css';\nimport Search from '../search/Search'\nimport Loading from '../loading/Loading';\nimport Masonry from 'react-masonry-css'\nimport Fade from 'react-reveal/Fade';\nimport Selector from '../../containers/SelectorContainer'\n\nclass Home extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      page: 1, \n      hoveredImg: '',\n      previewId:'',\n      searchTxt: this.props.match.params.query === undefined ? '' : this.props.match.params.query,\n    };\n  }\n\n  componentDidMount() {\n    const { getImgsList,query,getRandomImgs, getSynonymList,initImgs,showTopSearch} = this.props;\n    const { page} = this.state;\n    window.addEventListener('scroll', this.handleScroll);\n    showTopSearch(false);\n\n    if(this.props.match.params.query !== undefined) { //依照關鍵字搜尋\n      initImgs([])\n      query(this.props.match.params.query)\n      getSynonymList(this.props.match.params.query)\n      getImgsList(page, this.props.match.params.query);\n    } else { //隨機搜尋\n      query('')\n      initImgs([])\n      getRandomImgs(page)\n    }\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.handleScroll);\n  }\n\n  componentDidUpdate(prevProps,prevState) {\n    const { isLoadingSaveImg,getImgsList,query, getSynonymList,initImgs} = this.props;\n    const { page,searchTxt } = this.state;\n\n    if (prevProps.isLoadingSaveImg === true && isLoadingSaveImg === false) {\n      this.setState({\n        showSelector:false,\n      })\n      document.body.style.overflow = \"visible\"\n    }\n    if (prevState.searchTxt !== searchTxt) {\n      initImgs([])\n      query(searchTxt)\n      getSynonymList(searchTxt) //找同義詞\n      getImgsList(page, searchTxt);\n    }\n  }\n\n  handleSearchTxt = (item) => {\n    this.setState({\n      searchTxt: item,\n    })\n  }\n\n  handleScroll = () => {\n    // topSearchBar\n    const { showTopSearch } = this.props\n    if( document.documentElement.scrollTop > 250) {\n      showTopSearch(true);\n    } else {\n      showTopSearch(false);\n    }\n    // 下拉加載\n    const scrollTop = document.documentElement.scrollTop;\n    const clientHeight = document.documentElement.clientHeight;\n    const scrollHeight = document.documentElement.scrollHeight;\n    if (scrollHeight-clientHeight === scrollTop) {\n      const { page } = this.state;\n      const { getImgsList,queryTxt,getRandomImgs,totalPage,isLoadingRandomImgs,isLoadingGetImgs } = this.props;\n      if(totalPage !== 0 && page !== totalPage){\n        if(queryTxt === ''){\n          if(!isLoadingRandomImgs){\n            getRandomImgs(page + 1)\n            this.setState((prevState) => ({\n              page: prevState.page + 1,\n            }));\n          }\n        } else {\n          if(!isLoadingGetImgs){\n            getImgsList(page + 1, queryTxt);\n            this.setState((prevState) => ({\n              page: prevState.page + 1,\n            }));\n          }\n        }\n      }\n    }\n  }\n\n  handleHoverOver(id){\n    this.setState({\n      hoveredImg: id,\n    })\n  }\n\n  handleHoverOut = () => {\n    this.setState({\n      hoveredImg: ''\n    })\n  }\n\n  handleSelector(id){\n    this.setState({\n      previewId: id,\n      showSelector: true,\n    })\n    document.body.style.overflow = \"hidden\"\n    // alert('ok')\n  }\n\n  handleClose = () => {\n    this.setState({\n      showSelector:false,\n    })\n    document.body.style.overflow = \"visible\"\n  }\n\n  render() {\n    \n    const { page,previewId,showSelector,hoveredImg } = this.state;\n    const { history, imgs, isLoadingGetImgs,query,queryTxt,getImgsList,initImgs, isLoadingRandomImgs,syn,isLoadingSynonym, getSynonymList, isAuthenticated,totalPage} = this.props;\n    const breakpointColumnsObj = {\n      default: 3,\n      1100: 2,\n      700: 1\n    };\n    return (\n      <Fragment>\n        <div className=\"container\" >\n          {showSelector && <Selector showSelector = {true}  previewId={previewId} \n          handleClose={this.handleClose}/>}\n\n          <Search query={query} queryTxt={queryTxt} getImgsList={getImgsList} page={page} initImgs={initImgs} history={history} syn={syn} isLoadingSynonym={isLoadingSynonym} getSynonymList={getSynonymList}\n          handleSearchTxt={this.handleSearchTxt}\n          />\n          {imgs ?\n          <ul>\n            <Masonry\n              breakpointCols={breakpointColumnsObj}\n              className=\"my-masonry-grid\"\n              columnClassName=\"my-masonry-grid_column\"\n            >\n              {imgs.map((item, index) => {\n                  if (index > 0 && imgs[index]) {\n                    return (\n                      <div className=\"outter\"                           \n                      onMouseOver={() => this.handleHoverOver(imgs[index].id)}\n                      onMouseOut={this.handleHoverOut}>\n                        <button className={hoveredImg === imgs[index].id? 'save_button':'hide_style'} \n                        onClick={isAuthenticated ? () => this.handleSelector(imgs[index].id) : ()=> history.push('/login')}><i class=\"fas fa-plus\"></i></button>\n                        <Fade bottom duration={600} >\n                          <li key={imgs[index].id} role=\"presentation\" \n                          onClick={() => history.push(`/images/${imgs[index].id}`)}>\n                            <div className={hoveredImg === imgs[index].id? 'hover_layer':'hide_style'}></div>\n                            <img src={imgs[index].urls.regular} alt=\"\" />\n                          </li>\n                        </Fade>\n                      </div>\n                    );\n                  }\n                })\n              }\n            </Masonry>\n            {totalPage === 0 && <div className=\"empt_notice\">No results found, please try different keyword.</div>}\n            {page === totalPage && <div className=\"empt_notice\">{`${page} / ${totalPage}`}</div>}\n          </ul>\n          : <Loading />}\n        </div>\n      </Fragment>\n    );\n  }\n}\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}